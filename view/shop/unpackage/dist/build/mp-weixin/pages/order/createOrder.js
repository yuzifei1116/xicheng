(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"2e21":function(o,e,r){"use strict";r.r(e);var t=r("5c6c"),n=r("ee4c");for(var i in n)"default"!==i&&function(o){r.d(e,o,function(){return n[o]})}(i);r("e788");var a,c=r("f0c5"),s=Object(c["a"])(n["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],a);e["default"]=s.exports},"314b":function(o,e,r){},"5c6c":function(o,e,r){"use strict";var t,n=function(){var o=this,e=o.$createElement,r=(o._self._c,o.__map(o.cartInfo,function(e,r){var t=o.indexUrl(e.productInfo.image);return{$orig:o.__get_orig(e),m0:t}})),t=Number(o.confirmOrder.priceGroup.storePostage);o.$mp.data=Object.assign({},{$root:{l0:r,m1:t}})},i=[];r.d(e,"b",function(){return n}),r.d(e,"c",function(){return i}),r.d(e,"a",function(){return t})},abd3:function(o,e,r){"use strict";(function(o){r("3c4b"),r("921b");t(r("66fd"));var e=t(r("2e21"));function t(o){return o&&o.__esModule?o:{default:o}}o(e.default)}).call(this,r("543d")["createPage"])},e38f:function(o,e,r){"use strict";(function(o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={data:function(){return{maskState:0,desc:"",payType:1,couponList:[],addressData:[{real_name:"",phone:"",province:"",city:"",district:"",detail:""}],cartId:0,cartInfo:[],cartInfoId:"",total:0,coupon:[],isCoupon:!1,couponName:"",priceA:0,couponInfoA:[],isTotal:0,discountPrice:0,isCouponName:"选择优惠券",isZf:1,now_money:0,confirmOrder:null,address:"",isClick:!0,userInfo:[],check:!1,deductIntPrice:0,integral:0,isMer:!1,merIds:""}},onLoad:function(o){getApp().user_api(!0),this.cartId=o.cartId,this.address=o.address,this.confirm_order()},onShow:function(){this.addressData=[],this.addressIist()},methods:{confirm_order:function(){var o=this,e="/gzh/deal_api/confirm_order",r={cartId:o.cartId};console.log("啊啊啊啊啊",o.cartId,getApp().globalData.userInfo),getApp().http(e,r,function(e){o.cartInfo=e.cartInfo,o.confirmOrder=e;for(var r=0;r<e.cartInfo.length;r++){var t=e.cartInfo[r].mer_id;1==t&&(o.couponName="选择优惠券",o.isCoupon=!0),console.log("产品",o.cartInfo,t)}var n="/gzh/user_api/my";getApp().http(n,{},function(e){console.log("个人信息",e),o.userInfo=e,o.now_money=e.now_money,o.integral=e.integral,o.totalCount(),o.getUIseCouponOrder()})},!1,"post")},totalCount:function(){var o=this,e=o.cartInfo,r=0;for(var t in e){var n=e[t].productInfo.attrInfo?e[t].productInfo.attrInfo.price:e[t].productInfo.price;r=Number(r)+Number(e[t].cart_num)*Number(n),o.total=r,o.isTotal=Number(r)+Number(o.confirmOrder.priceGroup.storePostage),o.cartInfoId+=e[t].productInfo.id+",",o.merIds+=e[t].mer_id+",",console.log(o.merIds,"商铺id")}},getUIseCouponOrder:function(){var o=this;console.log("商品id",o.cartInfo);var e="/gzh/coupons_api/get_use_coupon_order",r={totalPrice:o.total,pids:o.cartInfoId,mer_ids:o.merIds};getApp().http(e,r,function(e){o.couponList=e,console.log("地址",o.couponList)})},radioChange:function(o){var e=this;e.coupon=o.detail.value;var r=e.coupon,t=r.coupon_discount,n=r.coupon_price,i=e.cartInfo,a=r.coupon_type,c=r.coupon_products;if(console.log("sdfsdf对对对",r,e.coupon),"no"==r)e.isCoupon=!1,e.discountPrice=0,e.isTotal=e.total+Number(e.confirmOrder.priceGroup.storePostage),e.isCouponName="不使用",console.log("不使用");else{if(e.isCoupon=!0,e.couponName=r.coupon_title,""==c){for(var s=0;s<i.length;s++)r.mer_id==i[s].mer_id&&e.priceA<i[s].truePrice&&(e.priceA=i[s].truePrice,e.couponInfoA=i[s],console.log("不是电",e.priceA,e.couponInfoA));console.log("折扣金额",e.couponList,r),console.log("全部商品",e.priceA)}else for(var d=0;d<c.length;d++)for(var u=0;u<i.length;u++)r.mer_id==i[u].mer_id&&i[u].product_id===parseInt(c[d])&&e.priceA<i[u].truePrice&&(e.priceA=i[u].truePrice,e.couponInfoA=i[u]);if(2==a){var l=e.couponInfoA.truePrice,f=l-l*t,p=e.total-f;e.discountPrice=f,e.isTotal=p+Number(e.confirmOrder.priceGroup.storePostage),console.log("折扣金额",e.couponList,r)}else if(1==a){var g=e.couponInfoA.truePrice;if(n>=g){console.log("大");var m=e.total-g;e.discountPrice=g,e.isTotal=m+Number(e.confirmOrder.priceGroup.storePostage)}else{console.log("小");var h=g-(g-n),I=e.total-h;e.discountPrice=h+Number(e.confirmOrder.priceGroup.storePostage),e.isTotal=I}}}},addressIist:function(){var o=this,e="/gzh/user_api/user_address_list";getApp().http(e,{},function(e){console.log("地址少时诵诗书",o.address),""==o.address||void 0==o.address||null==o.address?(console.log("灌灌灌灌",o.address),o.addressData=e[0]?e[0]:o.addressData):(console.log("是是是",o.address),o.addressData=e[o.address])})},clickAdd:function(){o.navigateTo({url:"/pages/address/address?source=1&cartId="+this.cartId+"&adr=3"})},indexUrl:function(o){var e=o.indexOf("http");return-1==e?this.webUrl+"/"+o:o},checkboxChange:function(o){var e=this;e.check=!e.check;var r=e.userInfo.integral,t=e.confirmOrder.integralRatio;if(e.check){var n=r*t,i=e.total/t;if(n>e.total){var a=r-i;e.userInfo.integral=a.toFixed(2),e.deductIntPrice=e.total,e.isTotal=e.isTotal-e.deductIntPrice,console.log("积分大",i,n,e.userInfo.integral)}else{e.userInfo.integral=0,e.deductIntPrice=n.toFixed(2);var c=e.isTotal-e.deductIntPrice;e.isTotal=c.toFixed(2),console.log("商品金额大",e.isTotal,i,n)}}else e.isTotal=e.total+Number(e.confirmOrder.priceGroup.storePostage),e.userInfo.integral=e.integral},toggleMask:function(o){var e=this,r="show"===o?10:300,t="show"===o?1:0;this.maskState=2,setTimeout(function(){e.maskState=t},r)},numberChange:function(o){this.number=o.number},changePayType:function(o){this.payType=o},payment:function(o){var e=this;e.isZf=o,1==e.isZf?console.log("微信支付"):console.log("余额支付")},formSubmit:function(e){o.showLoading({mask:!0});var r=this,t=r.isZf;if(1==t)var n="weixin";else if(2==t){n="yue";if(r.now_money<r.isTotal)return getApp().showTip("余额不足","none"),!1}var i=r.addressData.id,a=r.coupon.id?r.coupon.id:"0",c=e.detail.value.mark,s=r.confirmOrder.combination_id,d=r.confirmOrder.seckill_id,u=r.confirmOrder.presale_id,l=r.check?1:0;console.log("提交",r.check,l);var f="/gzh/deal_api/create_order?key="+r.confirmOrder.orderKey,p={payType:n,addressId:i,couponId:a,mark:c,pinkId:0,useIntegral:l,presale_id:u,combinationId:s,seckill_id:d,bargainId:0};getApp().http(f,p,function(e){if(console.log("创建订单返回",n,e),200==e.code){var t=e.data.status,i=e.data.result.orderId,a=e.data.result.jsConfig,c="/pages/money/paySuccess?order_id="+i+"&msg="+e.msg,s="/pages/order/order?state=0";switch(console.log("创建订单返回2",t),t){case"ORDER_EXIST":case"EXTEND_ORDER":case"PAY_ERROR":o.hideLoading(),getApp().showTip(e.msg,"none");break;case"SUCCESS":o.hideLoading(),o.redirectTo({url:c}),getApp().showTip(e.msg,"success");break;case"WECHAT_PAY":console.log("微信支付");var d="/gzh/auth_api/get_jsdk";o.request({url:r.webUrl+d,method:"GET",header:{"X-Requested-With":"XMLHttpRequest"},data:{url:btoa(window.location.href)},success:function(e){console.log("微信支付");var r=JSON.parse(e.data);console.log("微信支付11",r),mapleWx(r,function(){this.chooseWXPay(a,function(){console.log("执行着了么#####"),o.hideLoading(),o.redirectTo({url:c})},{fail:function(e){console.log("失败",e),o.showToast({title:"支付失败"}),o.redirectTo({url:s})},cancel:function(){o.showToast({title:"您已取消支付"}),o.redirectTo({url:s})},success:function(){console.log("成功过过"),window.history.back(-1)}})})}});break}}else getApp().showTip(e.msg,"none")},!0,"post")},stopPrevent:function(){}}};e.default=r}).call(this,r("543d")["default"])},e788:function(o,e,r){"use strict";var t=r("314b"),n=r.n(t);n.a},ee4c:function(o,e,r){"use strict";r.r(e);var t=r("e38f"),n=r.n(t);for(var i in t)"default"!==i&&function(o){r.d(e,o,function(){return t[o]})}(i);e["default"]=n.a}},[["abd3","common/runtime","common/vendor"]]]);
(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/integral/integralOrder"],{"23aa":function(o,t,e){"use strict";e.r(t);var n=e("8208"),r=e.n(n);for(var i in n)"default"!==i&&function(o){e.d(t,o,function(){return n[o]})}(i);t["default"]=r.a},"4fb8":function(o,t,e){"use strict";var n,r=function(){var o=this,t=o.$createElement,e=(o._self._c,o.indexUrl(o.cartInfo.image));o.$mp.data=Object.assign({},{$root:{m0:e}})},i=[];e.d(t,"b",function(){return r}),e.d(t,"c",function(){return i}),e.d(t,"a",function(){return n})},"6ef7":function(o,t,e){"use strict";(function(o){e("3c4b"),e("921b");n(e("66fd"));var t=n(e("dc57"));function n(o){return o&&o.__esModule?o:{default:o}}o(t.default)}).call(this,e("543d")["createPage"])},"7fa2":function(o,t,e){"use strict";var n=e("c2d3"),r=e.n(n);r.a},8208:function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e={data:function(){return{maskState:0,desc:"",payType:1,couponList:[],addressData:[{real_name:"",phone:"",province:"",city:"",district:"",detail:""}],cartId:0,cartInfo:[],cartInfoId:"",total:0,coupon:[],isCoupon:!1,couponName:"",priceA:0,couponInfoA:[],isTotal:0,discountPrice:0,isCouponName:"选择优惠券",isZf:1,now_money:0,confirmOrder:null,address:"",isClick:!0,userInfo:[],check:!1,deductIntPrice:0,integral:0,id:0,num:0}},onLoad:function(o){getApp().user_api(!0),this.id=o.id,this.num=o.num,this.address=o.address,this.confirm_order()},onShow:function(){this.addressData=[],this.addressIist()},methods:{confirm_order:function(){var o=this,t="/gzh/shop_api/product_detail",e={id:o.id};console.log("啊啊啊啊啊",getApp().globalData.userInfo),getApp().http(t,e,function(t){o.cartInfo=t;var e="/gzh/user_api/my";getApp().http(e,{},function(t){console.log("个人信息",o.cartInfo),o.integral=t.integral}),o.totalCount()},!1)},totalCount:function(){var o=this;o.isTotal=o.cartInfo.integral*o.num},getUIseCouponOrder:function(){var o=this;console.log("商品id",o.cartInfo);var t="/gzh/coupons_api/get_use_coupon_order",e={totalPrice:o.total,pids:o.cartInfoId};getApp().http(t,e,function(t){o.couponList=t,console.log("地址",o.coupon)})},radioChange:function(o){var t=this;t.coupon=o.detail.value;var e=t.coupon,n=e.coupon_discount,r=e.coupon_price,i=t.cartInfo,a=e.coupon_type,s=e.coupon_products;if(console.log("sdfsdf对对对",e,t.coupon),"no"==e)t.isCoupon=!1,t.discountPrice=0,t.isTotal=t.total+Number(t.confirmOrder.priceGroup.storePostage),t.isCouponName="不使用",console.log("不使用");else{if(t.isCoupon=!0,t.couponName=e.coupon_title,""==s){for(var c=0;c<i.length;c++)t.priceA<i[c].truePrice&&(t.priceA=i[c].truePrice,t.couponInfoA=i[c]);console.log("全部商品",t.priceA)}else for(var u=0;u<s.length;u++)for(var l=0;l<i.length;l++)i[l].product_id===parseInt(s[u])&&t.priceA<i[l].truePrice&&(t.priceA=i[l].truePrice,t.couponInfoA=i[l]);if(2==a){var d=t.couponInfoA.truePrice,f=d-d*n,p=t.total-f;t.discountPrice=f,t.isTotal=p+Number(t.confirmOrder.priceGroup.storePostage),console.log("折扣金额",f,p)}else if(1==a){var g=t.couponInfoA.truePrice;if(r>=g){console.log("大");var h=t.total-g;t.discountPrice=g,t.isTotal=h+Number(t.confirmOrder.priceGroup.storePostage)}else{console.log("小");var m=g-(g-r),v=t.total-m;t.discountPrice=m+Number(t.confirmOrder.priceGroup.storePostage),t.isTotal=v}}}},addressIist:function(){var o=this,t="/gzh/user_api/user_address_list";getApp().http(t,{},function(t){console.log("地址少时诵诗书",o.address),""==o.address||void 0==o.address||null==o.address?(console.log("灌灌灌灌",o.address),o.addressData=t[0]?t[0]:o.addressData):(console.log("是是是",o.address),o.addressData=t[o.address])})},clickAdd:function(){o.navigateTo({url:"/pages/address/address?source=1&id="+this.id+"&num="+this.num+"&adr=2"})},indexUrl:function(o){var t=o.indexOf("http");return-1==t?this.webUrl+"/"+o:o},checkboxChange:function(o){var t=this;t.check=!t.check;var e=t.userInfo.integral,n=t.confirmOrder.integralRatio;if(t.check){var r=e*n,i=t.total/n;if(r>t.total){var a=e-i;t.userInfo.integral=a.toFixed(2),t.deductIntPrice=t.total,console.log("积分大",i,r,t.userInfo.integral)}else t.userInfo.integral=0,t.deductIntPrice=r.toFixed(2),t.isTotal=t.isTotal-t.deductIntPrice,console.log("商品金额大",i,r)}else t.userInfo.integral=t.integral,console.log("积分",t.userInfo.integral)},toggleMask:function(o){var t=this,e="show"===o?10:300,n="show"===o?1:0;this.maskState=2,setTimeout(function(){t.maskState=n},e)},numberChange:function(o){this.number=o.number},changePayType:function(o){this.payType=o},payment:function(o){var t=this;t.isZf=o,1==t.isZf?console.log("微信支付"):console.log("余额支付")},formSubmit:function(t){o.showLoading({mask:!0});var e=this;if(console.log("水电费水电费",e.integral,e.isTotal),e.integral<e.isTotal)return getApp().showTip("积分不足","none"),!1;var n=e.addressData.id,r=t.detail.value.mark;console.log("提交",n,r);var i="/gzh/shop_api/buy",a={id:e.id,num:e.num,addr_id:n,mark:r};getApp().http(i,a,function(t){200==t.code?(console.log("创建订单返回2"),getApp().showTip(t.msg,"success"),setTimeout(function(){o.navigateTo({url:"/pages/integral/intOrder"})},1500)):getApp().showTip(t.msg,"none")},!0,"post")},stopPrevent:function(){}}};t.default=e}).call(this,e("543d")["default"])},c2d3:function(o,t,e){},dc57:function(o,t,e){"use strict";e.r(t);var n=e("4fb8"),r=e("23aa");for(var i in r)"default"!==i&&function(o){e.d(t,o,function(){return r[o]})}(i);e("7fa2");var a,s=e("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=c.exports}},[["6ef7","common/runtime","common/vendor"]]]);